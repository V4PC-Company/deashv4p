<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V4 | CVC Dashboard (2026+)</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/webp;base64,UklGRp4DAABXRUJQVlA4IJIDAADQGACdASpQAFAAPpE6mUgloyKhJ7VeuLASCWwAwNm0/pPQibU69+Sn4wdQXwh4R/HDqpjr9kv3z7wPeB/lfYf5gH6Xf5H+UdZ/zAftn+wHvE/gB2AH9u6lz0AP1A9Kj91fhX/c39jPaWcru3jov0zhW9PU98+byajkjDFAbXoNu8wmuxYjZlGeKQRt6t6fm8telKsGsCGRAvJItQjGLYBsYC7Clke1NwUIqiVP6MLX4s32uk0XiwOYRmQaWFH51pWyxrWqOw41j0D8j5Hui0AA/v55tLcV4Y6mmmK/BuN3V6PZpPf1qoPqLCQHdSnbtv2a9czILQkoWChlU+W8jk1hh1CG1bBwQm11hFcnUyz8tmcIGUOlm5/KZmKX5S/yFMpIF5Ks1tNhOKyBsyf8/NLis71L+0q1eDdBMCRjSEhE3lo5yoSWIy+sIfH2WWfJbXLjN9WHWnDdJ9ZG6VGisCNgQSdmtkCcEhKJd8rUabrLeYRFMk0YJxK0NSX/QVYd62GykOxoZgLBcpsTgvQnyguq2JftBApkXdP/9fw3BmHgVrDkA6JnG3IyAXjKYvUx+r1Aw79CnP31UYIVw6zH9ip8fkklQaSNLi7fNaNG0BB7PK+qg/5C5JVRlJQCTov8dNEsPOyyNy2Svs1hDehoaXUo0POh5WrBDEYFZcZG1JoDVe1fprQvvr/RctYH9vfJHgPnM8brHCl96vcXqQcgzMLAbiajQr2ZIL5YuUXoRNyOBAuj4Ng2QN5rSQeQaWG7Kkj7iqk8yh80M0wrqAgtP7fyHFt+zgfx1zFB0BRjcdDA6oPmA1MytL3G2NGf9iKM30uVwGcvh2/bYQMbYIz/G211wIPkUrMDArQFNyXeUv8/WoMcN5YmWrphrUpOd2qfuAXZrse5nUBVhHpfua2L1+kPbvAFvz85aR3eywiSx/S82jx3n6Nt1WGuVbo7ZimNVLSiW0UEv6PxQQr0ztwCnlx8A5GoB+a8MCWRWziiXbiWPagExpf8xPxpy40AnTZT4xUJMVSA3kA1HgbS9Agu3IC+ric/Aj26/Yyv27flEDzMxM+TlvfBD8oi498PFYQH4+ric7bP27nwRcb8OeBLTIAeTW4lRpPVb8M2oCQDafZxS2gqwq6/yVN5+/5p9OA4Qi5uGbU5KBIMm+Cf109IfwLfrn0DrfzxjgvxoyAgfGe0bsB8PGWQF+dBAf9t6bLdCEAAAA==" type="image/png">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <style>
        /* --- VISUAL DARK NEON PREMIUM (Red/Black V4 Theme) --- */
        :root {
            --bg-main: #0a0a0a; 
            --bg-secondary: #141414; 
            --bg-tertiary: #1f1f1f; 
            --text-bright: #ffffff;
            --text-muted: #8c8c8c;
            --v4-neon-red: #ff1f2d; 
            --v4-dark-red: #a30009;
            --cvc-neon-yellow: #ffd700;
            --status-green: #00c853;
            --status-blue-dark: #0D47A1; 
            --status-purple: #d0b0ff; 
            --status-cyan: #a8dadc;   
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-main);
            color: var(--text-bright);
            height: 100vh;
            overflow: hidden;
        }

        /* LOGIN */
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-main); display: flex; justify-content: center; align-items: center; z-index: 9999; background-image: radial-gradient(circle at center, rgba(255,31,45,0.1) 0%, rgba(10,10,10,1) 70%); transition: opacity 0.5s ease; }
        .login-box { background: var(--bg-secondary); padding: 40px; border-radius: 24px; width: 450px; text-align: center; border: 1px solid #2a2a2a; box-shadow: 0 0 40px rgba(255, 31, 45, 0.15); display: flex; flex-direction: column; align-items: center; }
        .login-input { width: 100%; padding: 15px; margin-bottom: 20px; background: var(--bg-main); border: 1px solid #333; border-radius: 12px; color: var(--text-bright); outline: none; }
        .login-btn { width: 100%; padding: 15px; background: linear-gradient(90deg, var(--v4-dark-red), var(--v4-neon-red)); color: white; border: none; border-radius: 12px; font-weight: 700; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; }
        .login-btn:hover { transform: scale(1.02); box-shadow: 0 0 20px rgba(255, 31, 45, 0.5); }

        /* DASHBOARD */
        #dashboard-container { display: none; height: 100vh; }
        .sidebar { width: 280px; background: var(--bg-secondary); padding: 30px; display: flex; flex-direction: column; border-right: 1px solid #222; }
        .main-content { flex: 1; padding: 40px; overflow-y: auto; background: radial-gradient(circle at top right, rgba(20,20,20,1) 0%, rgba(10,10,10,1) 100%); }
        
        .nav-item { display: flex; align-items: center; padding: 12px 15px; color: var(--text-muted); border-radius: 12px; margin-bottom: 8px; transition: 0.3s; cursor: pointer; font-weight: 500; user-select: none; }
        .nav-item:hover { background: rgba(255, 255, 255, 0.05); color: white; }
        .nav-item.active { background: rgba(255, 31, 45, 0.1); color: var(--v4-neon-red); box-shadow: inset 3px 0 0 var(--v4-neon-red); }
        
        .user-profile { margin-top: auto; background: var(--bg-tertiary); padding: 15px; border-radius: 16px; display: flex; align-items: center; gap: 15px; border: 1px solid #333; }
        
        /* HEADER & FILTRO */
        .header { margin-bottom: 30px; border-bottom: 1px solid #222; padding-bottom: 20px; display: flex; justify-content: space-between; align-items: flex-end;}
        .header-content h1 { font-size: 1.8rem; margin-bottom: 5px; color: white; }
        .month-select { background: var(--bg-tertiary); color: white; border: 1px solid #444; padding: 10px 15px; border-radius: 8px; font-family: 'Inter'; font-size: 0.9rem; cursor: pointer; outline: none; min-width: 200px; }
        .month-select:hover { border-color: var(--v4-neon-red); }

        .card { background: var(--bg-secondary); border-radius: 20px; padding: 25px; border: 1px solid #222; box-shadow: 0 10px 30px rgba(0,0,0,0.3); position: relative; overflow: hidden; }
        .card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, var(--v4-neon-red), transparent); opacity: 0.5; }
        .card.yellow-accent::before { background: linear-gradient(90deg, var(--cvc-neon-yellow), transparent); }
        .card-title { color: var(--text-muted); font-size: 0.8rem; font-weight: 700; text-transform: uppercase; display: block; letter-spacing: 1px; }
        
        .card-header-flex { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .mini-badge { background-color: var(--v4-neon-red); color: white; padding: 4px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: 700; box-shadow: 0 2px 5px rgba(255, 31, 45, 0.3); border: 1px solid rgba(255,255,255,0.2); }

        .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 24px; }
        .span-4 { grid-column: span 4; } .span-8 { grid-column: span 8; } .span-12{ grid-column: span 12;}
        
        .dashboard-section { display: none; animation: fadeIn 0.4s ease; }
        .active-section { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* MAPA */
        .map-container { width: 100%; height: 500px; background-color: #1a1a1a; border-radius: 16px; border: 1px solid #333; z-index: 1; position: relative; }
        .custom-pin { background-color: var(--v4-neon-red); width: 14px; height: 14px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 10px var(--v4-neon-red); }
        .leaflet-popup-content-wrapper { background: #141414; color: white; border: 1px solid #333; font-family: 'Inter', sans-serif; }
        .leaflet-popup-tip { background: #141414; border: 1px solid #333; }
        .leaflet-container { background: #141414 !important; }

        .chart-wrapper { position: relative; height: 220px; width: 100%; display: flex; justify-content: center; align-items: center; }
        #error-display { display: none; position: fixed; bottom: 20px; right: 20px; background: #a30009; color: white; padding: 20px; border-radius: 10px; z-index: 10000; max-width: 400px; font-size: 0.9rem; border: 1px solid #ff1f2d; }
    </style>
</head>
<body>

    <div id="error-display"></div>

    <div id="login-screen">
        <div class="login-box">
            <img src="data:image/webp;base64,UklGRpwEAABXRUJQVlA4IJAEAAAwIACdASpkAGQAPpE6mkiloyihKdM9oRASCWwAwzINfxHVWaw8F+Tv4zdXRx14A/HTqbqW84rmH/DfdH2n/Ev/UT+S/H/0k+Y39qvVk/4H6O+8T0AP7N/juto9AD9kvTI9mz90v2M9l652egLFzncz+X4fgz/pa5Weg8BZff7QUMRkndjSRbke0SWMMF7b3i8tO2U5n/fLf7kH+rzOvldOytP22E+IYtKM9DnpwB0f/apKpGmaKeV3TR2w+DPWqJs+cHj05hK4LdIu5tpxewSoH3ibX6MrZdYZ2IajE2RKtXIuRICX7gq286h0OnOLRUG0IpTB2S6Sbxc+2QeG3f7j73LpbEdBToeoQAD+/ho9hyZTMp9GKhzwuQY1SyVredtSksnAQUklC2Cj5cCywtyamrMbzH+riqH8pEvrm+pKf/c8HDIfGaxeOXHJ0jyMOyP9u7TnDyIv1Nseo3Vyi2tsr63fhG3fPNc5zEjCf4+bNY13h3IsOXc9ZPZljpIXtCT44qg6obrXOGDsQh7n4nIHcmvFKk2nZQg7rmnFOKjgFw4OReQiV/PAnPxvo+MaqSgGdX6gKxk9S7Nsfz/v66lUorSd3yaPufE1DdxbmQ09ESbmAG60TZXl9DdmtmU0OfzBxVG6AFdOLwvi40gxcB6tkhQMtqqCy7CfzA4H4f9EFApWqUgoF+g5uQp+AufohKkZN1gEwcTIK3C1zOAmohVe9dGM3zSUqZccSVouFotBWEUXJY27+dozzBvjVUIIgPV7vw53gnqsf0NzexdTkX3U0Wjs87CzpX8X1a0ZKhxtBrpzkoEBQUJuuFnU+LkKBwk59CVqOXtNSTrlElFuNH0BFQFnY0Z7ct9Ngx7cf171v8c2Pr8pwub22NzFxV46eR+BnhpB36Zq5DNqNIEqM25TqV5hWLwqsh+/34Q+glSAp1SRvXULtT412KZvjKRRYMML+CkLXTVk9QUS7pesIS8EkYwfrurQFM7Je5rrtUehCgqqu8u7ewQ7S8RWS/usdSoysbwiratLHWdxsKIgbueeI0kQf2iem/KAdFqPA8A8wCV/3fhbCXXnLsWeanAgEmGx2JIgqksKTl4hJrS4H/161i/n7cGurYKbivk9f74+HJtfsJp36gxEecc7NxFl94xwakGPwvWm6OFtLMjPI2UiHyuqcCafB4iLbnvgBlkG+RRMw9gbD0VD/vnBFrrlGIw43bzlZ6L9h68c1PNwl4/FOOymmEsRNiTPOLb5+HC8oPlgc76FtrQjcxzftSA3wDbAGS6KzzTPuSraTPl6qU1Rpef5XIYj782ogfUTf4//O2hqBgKQA/GEJ9rcDdNYizeJf9oFhgyOmH28h8z1iGjKdR8wntPP8OuOgfOBBJxmUTEkkNy3mxaYujPep2okZhhYK7Uj1shAscED2fbr7WuQPsIyHvkYDYfzPdrmXles+/6R7//c+gf1l0SMZEs7OEAQJfJt5AWCl3+MKmPsU/6DOMgV2yAe5An6q7UBHTJ2ASL5WVe+GsYGIlTnIOeXwf56F3/kvDLdSklC6mL8AAAA">
            <h2 style="margin-bottom: 10px; font-size: 1.5rem; color: white;">V4 PLACERES&CO - CVC</h2>
            <p style="color: #666; font-size: 0.9rem; margin-bottom: 30px;">Acesso Restrito - Franchise Intelligence</p>
            <input type="text" class="login-input" placeholder="ID do Usu√°rio" value="cvc.admin">
            <input type="password" class="login-input" placeholder="Senha de Acesso" value="********">
            <button class="login-btn" onclick="enterDashboard()">Entrar</button>
        </div>
    </div>

    <div id="dashboard-container">
        <aside class="sidebar">
            <div style="display: flex; align-items: center; margin-bottom: 50px; gap: 15px;">
                <img src="data:image/webp;base64,UklGRp4DAABXRUJQVlA4IJIDAADQGACdASpQAFAAPpE6mUgloyKhJ7VeuLASCWwAwNm0/pPQibU69+Sn4wdQXwh4R/HDqpjr9kv3z7wPeB/lfYf5gH6Xf5H+UdZ/zAftn+wHvE/gB2AH9u6lz0AP1A9Kj91fhX/c39jPaWcru3jov0zhW9PU98+byajkjDFAbXoNu8wmuxYjZlGeKQRt6t6fm8telKsGsCGRAvJItQjGLYBsYC7Clke1NwUIqiVP6MLX4s32uk0XiwOYRmQaWFH51pWyxrWqOw41j0D8j5Hui0AA/v55tLcV4Y6mmmK/BuN3V6PZpPf1qoPqLCQHdSnbtv2a9czILQkoWChlU+W8jk1hh1CG1bBwQm11hFcnUyz8tmcIGUOlm5/KZmKX5S/yFMpIF5Ks1tNhOKyBsyf8/NLis71L+0q1eDdBMCRjSEhE3lo5yoSWIy+sIfH2WWfJbXLjN9WHWnDdJ9ZG6VGisCNgQSdmtkCcEhKJd8rUabrLeYRFMk0YJxK0NSX/QVYd62GykOxoZgLBcpsTgvQnyguq2JftBApkXdP/9fw3BmHgVrDkA6JnG3IyAXjKYvUx+r1Aw79CnP31UYIVw6zH9ip8fkklQaSNLi7fNaNG0BB7PK+qg/5C5JVRlJQCTov8dNEsPOyyNy2Svs1hDehoaXUo0POh5WrBDEYFZcZG1JoDVe1fprQvvr/RctYH9vfJHgPnM8brHCl96vcXqQcgzMLAbiajQr2ZIL5YuUXoRNyOBAuj4Ng2QN5rSQeQaWG7Kkj7iqk8yh80M0wrqAgtP7fyHFt+zgfx1zFB0BRjcdDA6oPmA1MytL3G2NGf9iKM30uVwGcvh2/bYQMbYIz/G211wIPkUrMDArQFNyXeUv8/WoMcN5YmWrphrUpOd2qfuAXZrse5nUBVhHpfua2L1+kPbvAFvz85aR3eywiSx/S82jx3n6Nt1WGuVbo7ZimNVLSiW0UEv6PxQQr0ztwCnlx8A5GoB+a8MCWRWziiXbiWPagExpf8xPxpy40AnTZT4xUJMVSA3kA1HgbS9Agu3IC+ric/Aj26/Yyv27flEDzMxM+TlvfBD8oi498PFYQH4+ric7bP27nwRcb8OeBLTIAeTW4lRpPVb8M2oCQDafZxS2gqwq6/yVN5+/5p9OA4Qi5uGbU5KBIMm+Cf109IfwLfrn0DrfzxjgvxoyAgfGe0bsB8PGWQF+dBAf9t6bLdCEAAAA==">
                <span style="font-weight: 700; font-size: 1rem; letter-spacing: 0.5px;">V4 PLACERES</span> 
            </div>
            <div style="color: var(--text-muted); font-size: 0.75rem; margin-bottom: 15px; text-transform: uppercase;">Analytics</div>
            <div id="btn-overview" class="nav-item active" onclick="switchTab('section-overview', 'btn-overview')">Overview Geral</div>
            <div id="btn-leads" class="nav-item" onclick="switchTab('section-leads', 'btn-leads')">Performance de Leads</div>
            
            <div id="btn-cvc-status" class="nav-item" onclick="switchTab('section-cvc-status', 'btn-cvc-status')">Status CVC</div>
            
            <div id="btn-geo" class="nav-item" onclick="switchTab('section-geo', 'btn-geo')">Expans√£o Geogr√°fica</div>
            <div id="btn-lives" class="nav-item" onclick="switchTab('section-lives', 'btn-lives')">Relat√≥rio de Lives</div>
            <div id="btn-repasse" class="nav-item" onclick="switchTab('section-repasse', 'btn-repasse')">Lista de Repasse</div>
            <div class="user-profile">
                <img src="data:image/webp;base64,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">
                <div>
                    <div style="font-weight: 600; font-size: 0.9rem;">Admin CVC</div>
                    <div style="color: var(--text-muted); font-size: 0.75rem;">Gest√£o</div>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <div id="section-overview" class="dashboard-section active-section">
                <div class="header">
                    <div class="header-content">
                        <h1>Vis√£o Geral de Expans√£o</h1>
                        <p id="header-date">Selecione o per√≠odo para an√°lise</p>
                    </div>
                    <select id="monthFilter" class="month-select" onchange="applyDateFilter()">
                        <option value="all">Todo o Per√≠odo</option>
                        </select>
                </div>

                <div class="grid">
                    <div class="card span-4">
                        <div class="card-header-flex">
                            <span class="card-title" style="margin-bottom: 0;">STATUS DA BASE</span>
                            <div id="kpi-bant-mini" class="mini-badge">0 BANT4</div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="chartQualidade"></canvas>
                        </div>
                    </div>

                    <div class="card span-8"><span class="card-title" style="margin-bottom: 20px;">Top 5 Cidades (Vol. Leads)</span><div style="height: 220px;"><canvas id="chartCidades"></canvas></div></div>
                    
                    <div class="card span-4 yellow-accent"><span class="card-title" style="margin-bottom: 20px;">PARTICIPA√á√ÉO LIVE</span><div style="height: 200px;"><canvas id="chartReuniao"></canvas></div></div>
                    
                    <div class="card span-8"><span class="card-title" style="margin-bottom: 20px;">STATUS DO FUNIL (Detalhado)</span><div style="height: 200px;"><canvas id="chartLive"></canvas></div></div>

                    <div class="card span-12">
                        <span class="card-title" style="margin-bottom: 20px;">COMPARATIVO: LEADS (ACOMPANHAMENTO) X J√Å REPASSADOS</span>
                        <div style="height: 350px;"><canvas id="chartRepasseOverview"></canvas></div>
                    </div>
                </div>
            </div>
            
            <div id="section-leads" class="dashboard-section">
                <div class="header"><h1>Performance de Leads</h1><p>Evolu√ß√£o di√°ria (Filtro Aplicado).</p></div>
                <div class="grid"><div class="card span-12">
                    <span id="leads-title" class="card-title" style="margin-bottom: 20px;">VOLUME DI√ÅRIO DE LEADS</span>
                    <div style="height: 400px;"><canvas id="chartLeadsTimeline"></canvas></div>
                </div></div>
            </div>

            <div id="section-cvc-status" class="dashboard-section">
                <div class="header"><h1>Status com a CVC</h1><p>Lista de leads com status preenchido.</p></div>
                <div class="grid">
                    <div class="card span-12">
                         <div style="overflow-x: auto; max-height: 500px; border-radius: 8px; border: 1px solid #333;">
                            <table id="tabela-cvc" style="width: 100%; border-collapse: collapse; font-size: 0.85rem; text-align: left;">
                                <thead style="background: var(--bg-tertiary); position: sticky; top: 0; z-index: 5;">
                                    <tr>
                                        <th style="padding: 12px; border-bottom: 2px solid #333; color: white;">DATA</th>
                                        <th style="padding: 12px; border-bottom: 2px solid #333; color: white;">NOME</th>
                                        <th style="padding: 12px; border-bottom: 2px solid #333; color: white;">CIDADE</th>
                                        <th style="padding: 12px; border-bottom: 2px solid #333; color: white;">STATUS CVC</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="section-geo" class="dashboard-section">
                <div class="header"><h1>Expans√£o Geogr√°fica</h1><p>Mapeamento das pra√ßas.</p></div>
                <div class="grid"><div class="card span-12"><div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;"><span class="card-title" style="margin:0;">Mapa Interativo</span></div><div id="map" class="map-container"></div></div></div>
            </div>
            
            <div id="section-lives" class="dashboard-section">
                <div class="header"><h1>Relat√≥rio de Lives</h1><p>Cadastros para a Live.</p></div>
                <div class="grid"><div class="card span-12"><span class="card-title" style="margin-bottom: 20px;">EVOLU√á√ÉO DE CADASTROS (LIVE)</span><div style="height: 400px;"><canvas id="chartLivesTimeline"></canvas></div></div></div>
            </div>

            <div id="section-repasse" class="dashboard-section">
                <div class="header">
                    <h1>Lista de Repasse</h1>
                    <p>Consulta detalhada (Filtra tamb√©m pelo m√™s selecionado).</p>
                </div>
                <div class="grid">
                    <div class="card span-12">
                        <div style="margin-bottom: 20px; display: flex; gap: 15px; align-items: center;">
                            <input type="text" id="filtroRepasse" class="login-input" style="margin-bottom: 0; width: 300px;" placeholder="üîç Filtrar na lista (ex: nome, cidade...)" onkeyup="filtrarTabelaRepasse()">
                            <span id="total-repasse" class="mini-badge" style="background: var(--bg-tertiary); color: var(--text-muted);">Carregando...</span>
                        </div>
                        <div style="overflow-x: auto; max-height: 500px; border-radius: 8px; border: 1px solid #333;">
                            <table id="tabela-repasse" style="width: 100%; border-collapse: collapse; font-size: 0.85rem; text-align: left;">
                                <thead style="background: var(--bg-tertiary); position: sticky; top: 0; z-index: 5;">
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        // CONFIG LINKS
        const LEADS_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSq7tm8TN8KWT9sFip9UkeghlkZUOf3J-PKP035h1_EKNvOh-SXCcOakUTXKS5NI2xJ-hzRzQFruaRg/pub?gid=1787906905&single=true&output=csv';
        const LIVE_SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS8KWWCjb7eYtXhLEpsgxgRI7wurO2HqO0YLcoSAKxkdLTuVGNiQ86HRMz5AKLaIJbnckxl9P4d6TJP/pub?gid=859560778&single=true&output=csv';
        const REPASSE_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTJ8885BCS998s7tcXJCBrhAkHftxc3xE4JySQKQWmcHCPBW-2j7zlLDwjfB1HH0Q/pub?gid=211203921&single=true&output=csv';

        const COORDENADAS = { "sao paulo": [-23.5505, -46.6333], "sp": [-23.5505, -46.6333], "rio de janeiro": [-22.9068, -43.1729], "rj": [-22.9068, -43.1729], "belo horizonte": [-19.9167, -43.9345], "bh": [-19.9167, -43.9345], "brasilia": [-15.7975, -47.8919], "df": [-15.7975, -47.8919], "salvador": [-12.9777, -38.5016], "ba": [-12.9777, -38.5016], "fortaleza": [-3.7172, -38.5434], "ce": [-3.7172, -38.5434], "curitiba": [-25.4284, -49.2733], "pr": [-25.4284, -49.2733], "manaus": [-3.1190, -60.0217], "am": [-3.1190, -60.0217], "recife": [-8.0476, -34.8770], "pe": [-8.0476, -34.8770], "porto alegre": [-30.0346, -51.2177], "rs": [-30.0346, -51.2177], "goiania": [-16.6869, -49.2648], "go": [-16.6869, -49.2648], "belem": [-1.4558, -48.4902], "pa": [-1.4558, -48.4902], "guarulhos": [-23.4515, -46.5333], "campinas": [-22.9099, -47.0626], "sao luis": [-2.5307, -44.3068], "ma": [-2.5307, -44.3068], "sao goncalo": [-22.8275, -43.0631], "maceio": [-9.6662, -35.7351], "al": [-9.6662, -35.7351], "duque de caxias": [-22.7923, -43.3108], "campo grande": [-20.4697, -54.6201], "ms": [-20.4697, -54.6201], "natal": [-5.7945, -35.2110], "rn": [-5.7945, -35.2110], "teresina": [-5.0919, -42.8034], "pi": [-5.0919, -42.8034], "sao bernardo do campo": [-23.6914, -46.5646], "joao pessoa": [-7.1195, -34.8450], "pb": [-7.1195, -34.8450], "nova iguacu": [-22.7561, -43.4607], "santo andre": [-23.6638, -46.5383], "osasco": [-23.5336, -46.7920], "sao jose dos campos": [-23.2237, -45.9009], "sjc": [-23.2237, -45.9009], "jaboatao dos guararapes": [-8.1782, -35.0354], "ribeirao preto": [-21.1704, -47.8103], "uberlandia": [-18.9113, -48.2622], "contagem": [-19.9326, -44.0538], "sorocaba": [-23.5015, -47.4521], "aracaju": [-10.9472, -37.0731], "se": [-10.9472, -37.0731], "cuiaba": [-15.6014, -56.0979], "mt": [-15.6014, -56.0979], "vitoria": [-20.3155, -40.3128], "es": [-20.3155, -40.3128], "juiz de fora": [-21.7661, -43.3503], "londrina": [-23.3045, -51.1696], "niteroi": [-22.8808, -43.1043], "florianopolis": [-27.5954, -48.5480], "sc": [-27.5954, -48.5480], "palmeira dos indios": [-9.4079, -36.6322], "juazeiro do norte": [-7.2372, -39.3222] };

        // LISTA ESTRITA DE MASTERS PERMITIDOS (Para busca inteligente nas tabelas)
        const ALLOWED_MASTERS = [
            "ALESSANDRO CANALI", "CLAUDIO VILA NOVA", "CVC CAMPINAS", "CVC CE", 
            "CVC INTERIOR", "CVC MATRIZ", "DIRAN GUTIERREZ", "HELIO AUGUSTO SILVA JUNIOR", 
            "JOSE CARLOS QUILICI", "KLENIO REGO", "LARA BOSNICH", "LUIZ WALTER", 
            "MARCIO BARRETO", "MARIO GUASPARI", "THIAGO QUILICI", "WAGNER MOREIRA"
        ];

        // Vari√°veis Globais
        let RAW_LEADS = [];
        let RAW_REPASSE = [];
        let RAW_REPASSE_HEADER = [];
        
        let STRUCT_LIVE_DATA = []; 
        let CURRENT_FILTERED_LEADS = []; // Guarda os leads filtrados
        
        let chartQualidade, chartCidades, chartReuniao, chartLive, chartLeadsTimeline, chartLivesTimeline, chartRepasseOverview, map;

        function showError(msg) { document.getElementById('error-display').innerHTML = `<strong>‚ö†Ô∏è Erro:</strong><br>${msg}`; document.getElementById('error-display').style.display = 'block'; }

        function normalizeString(str) {
            if (!str) return "";
            return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toUpperCase().trim();
        }

        function enterDashboard() {
            document.getElementById('login-screen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('dashboard-container').style.display = 'flex';
                initCharts(); 
                setTimeout(initMap, 500); 
                fetchData();
            }, 500);
        }

        function switchTab(t, b) {
            document.querySelectorAll('.dashboard-section').forEach(e=>e.style.display='none');
            document.getElementById(t).style.display='block';
            document.querySelectorAll('.nav-item').forEach(e=>e.classList.remove('active'));
            document.getElementById(b).classList.add('active');
            if(t==='section-geo') setTimeout(()=> { if(map) map.invalidateSize(); }, 200);
        }

        function parseCSV(text) {
            const lines = text.split('\n');
            const separator = (lines[0].match(/;/g)||[]).length > (lines[0].match(/,/g)||[]).length ? ';' : ',';
            const result = [];
            for(let i=0; i<lines.length; i++) {
                if(!lines[i].trim()) continue;
                const regex = new RegExp(`(?:${separator}|\\r?\\n|^)(?:"([^"]*)"|([^"${separator}\\r\\n]*))`, 'gi');
                const row = [];
                let matches;
                while((matches = regex.exec(lines[i]))) row.push(matches[1] || matches[2] || ''.trim());
                result.push(row);
            }
            return result;
        }

        function getMonthYearFromDate(dateStr) {
            if(!dateStr) return null;
            const parts = dateStr.trim().split(' ')[0].split('/');
            if(parts.length >= 2) {
                const y = parts[2] && parts[2].length === 4 ? parts[2] : new Date().getFullYear();
                const m = parts[1].padStart(2, '0');
                return `${y}-${m}`;
            }
            return null;
        }

        function populateMonthFilter() {
            const months = new Set();
            RAW_LEADS.forEach(l => { const my = getMonthYearFromDate(l.data); if(my && my >= '2026-01') months.add(my); });
            
            // Opcional: puxar data do repasse tamb√©m (se a planilha tiver coluna de data na pos 0)
            if(RAW_REPASSE.length > 0 && RAW_REPASSE[0][0]) {
                RAW_REPASSE.forEach(r => { const my = getMonthYearFromDate(r[0]); if(my && my >= '2026-01') months.add(my); });
            }

            STRUCT_LIVE_DATA.forEach(item => { const my = getMonthYearFromDate(item.date); if(my && my >= '2026-01') months.add(my); });

            const sortedMonths = Array.from(months).sort().reverse(); 
            const select = document.getElementById('monthFilter');
            select.innerHTML = '<option value="all">Todo o Per√≠odo</option>';
            sortedMonths.forEach(m => {
                const [ano, mes] = m.split('-');
                const nomeMes = new Date(ano, mes - 1).toLocaleString('pt-BR', { month: 'long' }).toUpperCase();
                const opt = document.createElement('option');
                opt.value = m; opt.innerText = `${nomeMes} / ${ano}`;
                select.appendChild(opt);
            });
        }

        function applyDateFilter() {
            const selected = document.getElementById('monthFilter').value;
            
            let filteredLeads = RAW_LEADS;
            if(selected !== 'all') filteredLeads = RAW_LEADS.filter(l => getMonthYearFromDate(l.data) === selected);

            let filteredRepasse = RAW_REPASSE;
            // Se a planilha de repasse tiver datas na coluna 0, filtra tamb√©m
            if(selected !== 'all' && RAW_REPASSE.length > 0 && RAW_REPASSE[0][0] && RAW_REPASSE[0][0].includes('/')) {
                filteredRepasse = RAW_REPASSE.filter(r => getMonthYearFromDate(r[0]) === selected);
            }

            let filteredLiveStats = { presente: 0, ausente: 0, agendado: 0 };
            let filteredLiveTimeline = {};
            
            STRUCT_LIVE_DATA.forEach(item => {
                if(selected !== 'all') { if(getMonthYearFromDate(item.date) !== selected) return; }
                const s = item.status.toLowerCase();
                if (s === 'presente') filteredLiveStats.presente++;
                if (s === 'ausente') filteredLiveStats.ausente++;
                if (s === 'agendado') filteredLiveStats.agendado++;
                const matchTimeline = item.date.match(/(\d{2}\/\d{2})/);
                if(matchTimeline) filteredLiveTimeline[matchTimeline[1]] = (filteredLiveTimeline[matchTimeline[1]] || 0) + 1;
            });

            // Guarda globalmente os leads do per√≠odo selecionado
            window.CURRENT_FILTERED_LEADS = filteredLeads;

            updateDashboard(filteredLeads, filteredLiveStats, filteredLiveTimeline);
            
            const repasseWithHeader = [RAW_REPASSE_HEADER, ...filteredRepasse];
            renderRepasseTable(repasseWithHeader);
            updateRepasseChart(repasseWithHeader);
        }

        async function fetchData() {
            try {
                const [resLeads, resLive, resRepasse] = await Promise.all([
                    fetch(LEADS_URL).then(r => r.text()),
                    LIVE_SHEET_URL ? fetch(LIVE_SHEET_URL).then(r => r.text()) : Promise.resolve(""),
                    fetch(REPASSE_URL).then(r => r.text())
                ]);

                const rowsRepasse = parseCSV(resRepasse);
                // Evita problemas de repasse sem cabe√ßalho 
                if(rowsRepasse.length > 0) {
                     RAW_REPASSE_HEADER = rowsRepasse[0];
                     RAW_REPASSE = rowsRepasse.slice(1); 
                }

                const rowsLeads = parseCSV(resLeads);
                const headers = rowsLeads[0].map(h => h.toUpperCase().trim());
                
                const IDX = {
                    DATA: headers.findIndex(h => h.includes("DATA")),
                    NOME: headers.findIndex(h => h.includes("NOME")),
                    STATUS_CVC: headers.findIndex(h => h.includes("STATUS COM A CVC") || h === "STATUS"),
                    CIDADE: headers.findIndex(h => h.includes("CIDADE")),
                    STATUS_K: 11, 
                    STATUS_COLS: []
                };

                headers.forEach((h, i) => { if (h.includes("TENTATIVA")) IDX.STATUS_COLS.push(i); });
                
                if(IDX.DATA === -1) IDX.DATA = 0;
                if(IDX.NOME === -1) IDX.NOME = 1; 
                if(IDX.STATUS_CVC === -1) IDX.STATUS_CVC = 2; 
                if(IDX.CIDADE === -1) IDX.CIDADE = 5; 
                if(IDX.STATUS_COLS.length === 0) IDX.STATUS_COLS = [12,13,14,15,16];

                RAW_LEADS = rowsLeads.slice(1).map(cols => {
                    if(cols.length < 5 || !cols[IDX.DATA].match(/\d/)) return null;
                    
                    let finalStatus = "SEM RESPOSTA";
                    let foundMeaningful = false;
                    for (let colIndex of IDX.STATUS_COLS) {
                        const val = (cols[colIndex] || "").toUpperCase().trim();
                        if (!val || val === "-" || val === "") continue;
                        if (val.includes("BANT") || val.includes("QUALIFICADO")) { finalStatus = val; foundMeaningful = true; break; }
                        if (val.includes("PARTICIPOU") || val.includes("AGENDADA") || val.includes("CONTATADO")) { finalStatus = val; foundMeaningful = true; }
                        if (!foundMeaningful && !val.includes("SEM RESPOSTA")) { finalStatus = val; }
                    }

                    let statusK = (cols[IDX.STATUS_K] || "");
                    if(!statusK && cols.length > 10) statusK = cols[cols.length-2];
                    statusK = statusK.toUpperCase().trim();
                    if (statusK === "") statusK = "ATIVO"; 
                    
                    let statusCVCValue = (cols[IDX.STATUS_CVC] || "").trim();
                    const rawName = (cols[IDX.NOME] || "Sem Nome").trim();
                    const rawCity = cols[IDX.CIDADE] || "";
                    
                    // Busca inteligente do nome do Master varrendo a linha inteira da planilha Acompanhamento
                    let foundMaster = "";
                    for(let cell of cols) {
                        let upperCell = normalizeString(cell);
                        let matched = ALLOWED_MASTERS.find(m => upperCell.includes(normalizeString(m)));
                        if(matched) {
                            foundMaster = matched;
                            break;
                        }
                    }
                    
                    return { 
                        data: cols[IDX.DATA],
                        nome: rawName,
                        cidade: rawCity, 
                        status: finalStatus, 
                        statusK: statusK,
                        statusCVC: statusCVCValue,
                        master: foundMaster
                    };
                }).filter(i => i !== null);

                if(resLive) {
                    const rowsLive = parseCSV(resLive);
                    let currentLiveDate = null;
                    STRUCT_LIVE_DATA = [];
                    rowsLive.forEach(row => {
                        const rowString = row.join(' ');
                        if (rowString.match(/\d{2}\/\d{2}\/\d{4}/)) {
                            const match = rowString.match(/(\d{2}\/\d{2}\/\d{4})/);
                            if(match) currentLiveDate = match[1]; return; 
                        }
                        if(currentLiveDate) {
                            const statusCell = row.find(c => c && (c.toLowerCase() === 'presente' || c.toLowerCase() === 'ausente' || c.toLowerCase() === 'agendado'));
                            if (statusCell) STRUCT_LIVE_DATA.push({ date: currentLiveDate, status: statusCell });
                        }
                    });
                }
                populateMonthFilter();
                applyDateFilter(); 

            } catch(e) { console.error(e); showError("Erro ao carregar dados."); }
        }

        function renderRepasseTable(data) {
            const tableHead = document.querySelector("#tabela-repasse thead");
            const tableBody = document.querySelector("#tabela-repasse tbody");
            
            if(data.length === 0 || !data[0]) return;
            
            const headers = data[0];
            tableHead.innerHTML = `<tr>${headers.map(h => `<th style="padding: 12px; border-bottom: 2px solid #333; color: white;">${h}</th>`).join('')}</tr>`;
            tableBody.innerHTML = data.slice(1).map(row => {
                if(row.length < 1 || !row[0]) return '';
                return `<tr style="border-bottom: 1px solid #222;">${row.map(cell => `<td style="padding: 12px; color: var(--text-muted);">${cell}</td>`).join('')}</tr>`;
            }).join('');
            document.getElementById('total-repasse').innerText = `${data.length - 1} Registros`;
        }

        function filtrarTabelaRepasse() {
            const input = document.getElementById("filtroRepasse");
            const filter = input.value.toUpperCase();
            const table = document.getElementById("tabela-repasse");
            const tr = table.getElementsByTagName("tr");
            for (let i = 0; i < tr.length; i++) {
                let txtValue = tr[i].textContent || tr[i].innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) tr[i].style.display = ""; else tr[i].style.display = "none";
            }
        }

        function updateRepasseChart(data) {
            const rows = data.slice(1); // Tira o cabe√ßalho
            
            // Inicia os contadores de Repasse e Leads apenas para a lista permitida
            const repasseCounts = {};
            const leadsCounts = {};
            ALLOWED_MASTERS.forEach(m => {
                repasseCounts[m] = 0;
                leadsCounts[m] = 0;
            });

            // 1. Busca inteligente varrendo todas as colunas da Planilha Repasse
            rows.forEach(r => {
                for(let cell of r) {
                    if(!cell) continue;
                    let upperCell = normalizeString(cell);
                    
                    // Tenta achar um match exato da nossa lista
                    let matchedMaster = ALLOWED_MASTERS.find(m => upperCell.includes(normalizeString(m)));
                    if (matchedMaster) {
                        repasseCounts[matchedMaster]++;
                        break; // Achou o master nessa linha, n√£o precisa procurar mais
                    }
                }
            });

            // 2. Conta quantos Leads Entraram (Acompanhamento) para cada Master
            if (window.CURRENT_FILTERED_LEADS) {
                window.CURRENT_FILTERED_LEADS.forEach(l => {
                    if(l.master && ALLOWED_MASTERS.includes(l.master)) {
                        leadsCounts[l.master]++;
                    }
                });
            }

            // Filtra e ordena (mostra quem tem atividade em pelo menos uma das listas)
            const sortedMasters = ALLOWED_MASTERS
                .filter(m => repasseCounts[m] > 0 || leadsCounts[m] > 0)
                .sort((a,b) => (repasseCounts[b] + leadsCounts[b]) - (repasseCounts[a] + leadsCounts[a])); // Ordena pelo maior volume somado

            // Atualiza os dados no gr√°fico de duas barras
            chartRepasseOverview.data.labels = sortedMasters;
            chartRepasseOverview.data.datasets[0].data = sortedMasters.map(m => leadsCounts[m]); // Barra Amarela
            chartRepasseOverview.data.datasets[1].data = sortedMasters.map(m => repasseCounts[m]); // Barra Vermelha
            chartRepasseOverview.update();
        }

        function renderStatusCVCTable(leads) {
            const tbody = document.querySelector("#tabela-cvc tbody");
            const filtered = leads.filter(l => l.statusCVC !== "" && l.statusCVC !== "N√£o Preenchido" && l.statusCVC !== "Vazio");

            tbody.innerHTML = filtered.map(l => `
                <tr style="border-bottom: 1px solid #222;">
                    <td style="padding: 12px; color: var(--text-muted);">${l.data}</td>
                    <td style="padding: 12px; color: white; font-weight:bold;">${l.nome}</td>
                    <td style="padding: 12px; color: var(--text-muted);">${l.cidade}</td>
                    <td style="padding: 12px;"><span class="mini-badge" style="background: #ffd700; color: #000;">${l.statusCVC}</span></td>
                </tr>
            `).join('');
            
            if(filtered.length === 0) {
                tbody.innerHTML = `<tr><td colspan="4" style="padding: 20px; text-align: center; color: #666;">Nenhum lead com status CVC preenchido encontrado neste per√≠odo.</td></tr>`;
            }
        }

        function updateDashboard(leads, liveStats, liveTimeline) {
            const k_ativos = leads.filter(l => l.statusK === "ATIVO").length; 
            const k_qualificados = leads.filter(l => l.statusK.includes("QUALIFICADO")).length;
            const k_inativos = leads.filter(l => l.statusK.includes("INATIVO") || l.statusK.includes("DESATIVAR")).length;

            const k_agendados = leads.filter(l => l.status.includes("AGENDADA") || l.status.includes("REUNI√ÉO")).length;
            const k_congelado = leads.filter(l => l.statusK.includes("CONGELADO") || l.status.includes("CONGELADO")).length;
            const k_nutricao = leads.filter(l => l.statusK.includes("NUTRI√á√ÉO") || l.status.includes("NUTRI√á√ÉO")).length;

            chartQualidade.data.datasets[0].data = [k_ativos, k_qualificados, k_congelado, k_nutricao, k_inativos];
            chartQualidade.update();

            const bant4_total = leads.filter(l => l.status.includes('BANT') || l.status.includes('QUALIFICADO')).length;
            document.getElementById('kpi-bant-mini').innerText = `${bant4_total} BANT4`;

            const cityCount = {};
            leads.forEach(l => { if(l.cidade) cityCount[l.cidade] = (cityCount[l.cidade]||0)+1; });
            const topCities = Object.entries(cityCount).sort((a,b)=>b[1]-a[1]).slice(0,5);
            chartCidades.data.labels = topCities.map(c=>c[0]);
            chartCidades.data.datasets[0].data = topCities.map(c=>c[1]);
            chartCidades.update();

            chartReuniao.data.labels = ['Presente', 'Agendado', 'Ausente'];
            chartReuniao.data.datasets[0].backgroundColor = ['#00c853', '#0D47A1', '#d32f2f']; 
            chartReuniao.data.datasets[0].data = [liveStats.presente, liveStats.agendado, liveStats.ausente];
            chartReuniao.update();

            const contatado = leads.filter(l => l.status.includes('CONTATADO')).length;
            const semResp = leads.filter(l => l.status.includes('SEM RESPOSTA')).length;
            chartLive.data.datasets[0].data = [semResp, contatado, bant4_total, k_congelado, k_nutricao, liveStats.presente];
            chartLive.update();

            const dates = {};
            leads.forEach(l => { 
                let dStr = l.data.trim();
                const parts = dStr.split(' ')[0].split('/'); 
                if(parts.length >= 2) {
                    const displayKey = `${parts[0]}/${parts[1]}`;
                    dates[displayKey] = (dates[displayKey]||0) + 1;
                }
            });
            const labels = Object.keys(dates).sort((a, b) => {
                const [d1, m1] = a.split('/'); const [d2, m2] = b.split('/');
                return (parseInt(m1)*100 + parseInt(d1)) - (parseInt(m2)*100 + parseInt(d2));
            });
            chartLeadsTimeline.data.labels = labels;
            chartLeadsTimeline.data.datasets[0].data = labels.map(d=>dates[d]);
            chartLeadsTimeline.update();

            renderStatusCVCTable(leads);

            const liveLabels = Object.keys(liveTimeline).sort((a, b) => {
                const [d1, m1] = a.split('/'); const [d2, m2] = b.split('/');
                return (parseInt(m1)*100 + parseInt(d1)) - (parseInt(m2)*100 + parseInt(d2));
            });
            chartLivesTimeline.data.labels = liveLabels;
            chartLivesTimeline.data.datasets[0].data = liveLabels.map(d => liveTimeline[d] || 0);
            chartLivesTimeline.update();

            if(map) {
                map.eachLayer(l => { if(l.options.icon) map.removeLayer(l); });
                for(const [cidade, qtd] of Object.entries(cityCount)) {
                    const clean = cidade.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                    const coords = COORDENADAS[clean];
                    if(coords) L.marker(coords, { icon: L.divIcon({ className: 'custom-pin', iconSize:[14,14] }) }).addTo(map).bindPopup(`<b>${cidade}</b><br>${qtd} Leads`);
                }
            }
        }

        function initCharts() {
            Chart.defaults.color = '#8c8c8c'; Chart.defaults.font.family = 'Inter'; Chart.defaults.borderColor = 'rgba(255,255,255,0.05)';
            
            chartQualidade = new Chart(document.getElementById('chartQualidade'), {
                type: 'pie', 
                data: { 
                    labels: ['Ativos', 'Qualificados', 'Congelado', 'Nutri√ß√£o', 'Inativos'], 
                    datasets: [{ 
                        data: [0, 0, 0, 0, 0], 
                        backgroundColor: ['#ff1f2d', '#00c853', '#E1BEE7', '#B2DFDB', '#333333'], 
                        borderWidth: 0 
                    }] 
                },
                options: { 
                    maintainAspectRatio: false, 
                    plugins: { 
                        legend: { 
                            position: 'right', 
                            labels: { boxWidth: 10, usePointStyle: true, color: '#fff' } 
                        } 
                    } 
                }
            });

            const ctxCid = document.getElementById('chartCidades').getContext('2d');
            const grad = ctxCid.createLinearGradient(0,0,0,300); grad.addColorStop(0,'#ff1f2d'); grad.addColorStop(1,'#600000');
            chartCidades = new Chart(ctxCid, { type: 'bar', data: { labels: [], datasets: [{ label: 'Leads', data: [], backgroundColor: grad, borderRadius: 6, barThickness: 25 }] }, options: { maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { grid: { display: false } }, y: { grid: { display: false } } } } });
            
            chartReuniao = new Chart(document.getElementById('chartReuniao'), { type: 'pie', data: { labels: ['Presente', 'Agendado', 'Ausente'], datasets: [{ data: [0,0,0], backgroundColor: ['#00c853', '#0D47A1', '#d32f2f'], borderWidth: 0 }] }, options: { maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { boxWidth: 10, usePointStyle: true, color: '#fff' } } } } });
            
            chartLive = new Chart(document.getElementById('chartLive'), { 
                type: 'bar', 
                indexAxis: 'y', 
                data: { 
                    labels: ['SEM RESP', 'CONTATADO', 'BANT4', 'CONGELADO', 'NUTRI√á√ÉO', 'PARTICIPOU'], 
                    datasets: [{ 
                        data: [0,0,0,0,0,0], 
                        backgroundColor: ['#ff1f2d', '#ffd700', '#00c853', '#E1BEE7', '#B2DFDB', '#00c853'], 
                        borderRadius: 4 
                    }] 
                }, 
                options: { maintainAspectRatio: false, plugins: { legend: { display: false } } } 
            });

            const commonLineOptions = { maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { grid: { color: '#222' } }, y: { grid: { color: '#222' }, beginAtZero: true } } };
            chartLeadsTimeline = new Chart(document.getElementById('chartLeadsTimeline'), { type: 'line', data: { datasets: [{ label: 'Novos Leads', data: [], borderColor: '#ff1f2d', backgroundColor: 'rgba(255, 31, 45, 0.1)', fill: true, tension: 0.4 }] }, options: commonLineOptions });
            chartLivesTimeline = new Chart(document.getElementById('chartLivesTimeline'), { type: 'line', data: { datasets: [{ label: 'Cadastros Live', data: [], borderColor: '#ffd700', backgroundColor: 'rgba(255, 215, 0, 0.1)', fill: true, tension: 0.4 }] }, options: commonLineOptions });
        
            // ATUALIZA√á√ÉO: Gr√°fico Duplo (Grouped Bar Chart)
            chartRepasseOverview = new Chart(document.getElementById('chartRepasseOverview'), {
                type: 'bar',
                data: { 
                    labels: [], 
                    datasets: [
                        { label: 'Leads Entraram (Acomp.)', data: [], backgroundColor: '#ffd700', borderRadius: 4 },
                        { label: 'J√° na Planilha de Repasse', data: [], backgroundColor: '#ff1f2d', borderRadius: 4 }
                    ] 
                },
                options: { 
                    maintainAspectRatio: false, 
                    plugins: { 
                        legend: { 
                            display: true, 
                            position: 'top', 
                            labels: { color: '#8c8c8c', usePointStyle: true, boxWidth: 10 } 
                        } 
                    }, 
                    scales: { 
                        y: { beginAtZero: true, grid: { color: '#222' } }, 
                        x: { grid: { display: false } } 
                    } 
                }
            });
        }

        function initMap() { 
            if(!map) { 
                map = L.map('map').setView([-14.235, -51.925], 4); 
                L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                    attribution: '&copy; OpenStreetMap &copy; CARTO',
                    subdomains: 'abcd',
                    maxZoom: 19
                }).addTo(map); 
            } 
        } 
    </script>
</body>
</html>
